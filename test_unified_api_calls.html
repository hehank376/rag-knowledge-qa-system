<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»Ÿä¸€APIè°ƒç”¨æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fafafa;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #555;
        }
        
        .test-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .result-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .success {
            color: #28a745;
        }
        
        .error {
            color: #dc3545;
        }
        
        .info {
            color: #17a2b8;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ§ª ç»Ÿä¸€APIè°ƒç”¨æµ‹è¯•</h1>
            <p>æµ‹è¯•å‰ç«¯ä½¿ç”¨ç»Ÿä¸€apiClientè¿›è¡Œæ¨¡å‹ç®¡ç†APIè°ƒç”¨</p>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š æ¨¡å‹çŠ¶æ€ç®¡ç†</h3>
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="testGetModelStatus()">è·å–æ¨¡å‹çŠ¶æ€</button>
                <button class="btn btn-primary" onclick="testGetModelMetrics()">è·å–æ¨¡å‹æŒ‡æ ‡</button>
                <button class="btn btn-secondary" onclick="testHealthCheck()">å¥åº·æ£€æŸ¥</button>
            </div>
            <div id="statusResult" class="result-area">ç‚¹å‡»æŒ‰é’®æµ‹è¯•APIè°ƒç”¨...</div>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ æ¨¡å‹æ“ä½œç®¡ç†</h3>
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="testSwitchModel()">åˆ‡æ¢æ¨¡å‹</button>
                <button class="btn btn-primary" onclick="testAddModel()">æ·»åŠ æ¨¡å‹</button>
                <button class="btn btn-secondary" onclick="testModelTest()">æµ‹è¯•æ¨¡å‹</button>
            </div>
            <div id="operationResult" class="result-area">ç‚¹å‡»æŒ‰é’®æµ‹è¯•APIè°ƒç”¨...</div>
        </div>

        <div class="test-section">
            <h3>âš™ï¸ é…ç½®ç®¡ç†</h3>
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="testGetConfig()">è·å–é…ç½®</button>
                <button class="btn btn-primary" onclick="testUpdateConfig()">æ›´æ–°é…ç½®</button>
                <button class="btn btn-secondary" onclick="testValidateConfig()">éªŒè¯é…ç½®</button>
            </div>
            <div id="configResult" class="result-area">ç‚¹å‡»æŒ‰é’®æµ‹è¯•APIè°ƒç”¨...</div>
        </div>

        <div class="test-section">
            <h3>ğŸ“ˆ APIè°ƒç”¨ç»Ÿè®¡</h3>
            <div id="statsResult" class="result-area">
æˆåŠŸè°ƒç”¨: <span id="successCount">0</span>
å¤±è´¥è°ƒç”¨: <span id="errorCount">0</span>
æ€»è°ƒç”¨æ•°: <span id="totalCount">0</span>
æˆåŠŸç‡: <span id="successRate">0%</span>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥APIå®¢æˆ·ç«¯ -->
    <script src="js/api.js"></script>
    
    <script>
        // ç»Ÿè®¡å˜é‡
        let successCount = 0;
        let errorCount = 0;
        let totalCount = 0;

        function updateStats() {
            totalCount = successCount + errorCount;
            const successRate = totalCount > 0 ? ((successCount / totalCount) * 100).toFixed(1) : 0;
            
            document.getElementById('successCount').textContent = successCount;
            document.getElementById('errorCount').textContent = errorCount;
            document.getElementById('totalCount').textContent = totalCount;
            document.getElementById('successRate').textContent = successRate + '%';
        }

        function logResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            
            element.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            element.scrollTop = element.scrollHeight;
            
            if (type === 'success') {
                successCount++;
            } else if (type === 'error') {
                errorCount++;
            }
            updateStats();
        }

        // æ¨¡å‹çŠ¶æ€æµ‹è¯•
        async function testGetModelStatus() {
            try {
                logResult('statusResult', 'æ­£åœ¨è·å–æ¨¡å‹çŠ¶æ€...', 'info');
                const result = await apiClient.getModelStatus();
                logResult('statusResult', `æ¨¡å‹çŠ¶æ€è·å–æˆåŠŸ: ${JSON.stringify(result, null, 2)}`, 'success');
            } catch (error) {
                logResult('statusResult', `æ¨¡å‹çŠ¶æ€è·å–å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testGetModelMetrics() {
            try {
                logResult('statusResult', 'æ­£åœ¨è·å–æ¨¡å‹æŒ‡æ ‡...', 'info');
                const result = await apiClient.getModelMetrics();
                logResult('statusResult', `æ¨¡å‹æŒ‡æ ‡è·å–æˆåŠŸ: ${JSON.stringify(result, null, 2)}`, 'success');
            } catch (error) {
                logResult('statusResult', `æ¨¡å‹æŒ‡æ ‡è·å–å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testHealthCheck() {
            try {
                logResult('statusResult', 'æ­£åœ¨æ‰§è¡Œå¥åº·æ£€æŸ¥...', 'info');
                const result = await apiClient.performModelHealthCheck();
                logResult('statusResult', `å¥åº·æ£€æŸ¥å®Œæˆ: ${JSON.stringify(result, null, 2)}`, 'success');
            } catch (error) {
                logResult('statusResult', `å¥åº·æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ¨¡å‹æ“ä½œæµ‹è¯•
        async function testSwitchModel() {
            try {
                logResult('operationResult', 'æ­£åœ¨åˆ‡æ¢æ¨¡å‹...', 'info');
                const result = await apiClient.switchActiveModel('embedding', 'test-model');
                logResult('operationResult', `æ¨¡å‹åˆ‡æ¢æˆåŠŸ: ${JSON.stringify(result, null, 2)}`, 'success');
            } catch (error) {
                logResult('operationResult', `æ¨¡å‹åˆ‡æ¢å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testAddModel() {
            try {
                logResult('operationResult', 'æ­£åœ¨æ·»åŠ æ¨¡å‹...', 'info');
                const config = {
                    name: 'test_model_' + Date.now(),
                    provider: 'mock',
                    model_name: 'test-model-v1',
                    config: {
                        batch_size: 32,
                        api_key: 'test_key'
                    },
                    enabled: true,
                    priority: 5
                };
                const result = await apiClient.addModel('embedding', config);
                logResult('operationResult', `æ¨¡å‹æ·»åŠ æˆåŠŸ: ${JSON.stringify(result, null, 2)}`, 'success');
            } catch (error) {
                logResult('operationResult', `æ¨¡å‹æ·»åŠ å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testModelTest() {
            try {
                logResult('operationResult', 'æ­£åœ¨æµ‹è¯•æ¨¡å‹...', 'info');
                const result = await apiClient.testModel('embedding', 'test-model');
                logResult('operationResult', `æ¨¡å‹æµ‹è¯•å®Œæˆ: ${JSON.stringify(result, null, 2)}`, 'success');
            } catch (error) {
                logResult('operationResult', `æ¨¡å‹æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é…ç½®ç®¡ç†æµ‹è¯•
        async function testGetConfig() {
            try {
                logResult('configResult', 'æ­£åœ¨è·å–é…ç½®...', 'info');
                const result = await apiClient.getConfig();
                logResult('configResult', `é…ç½®è·å–æˆåŠŸ: ${JSON.stringify(result, null, 2)}`, 'success');
            } catch (error) {
                logResult('configResult', `é…ç½®è·å–å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testUpdateConfig() {
            try {
                logResult('configResult', 'æ­£åœ¨æ›´æ–°é…ç½®...', 'info');
                const configData = {
                    embeddings: {
                        provider: 'mock',
                        model: 'test-embedding-updated',
                        batch_size: 64
                    }
                };
                const result = await apiClient.updateModelConfig(configData);
                logResult('configResult', `é…ç½®æ›´æ–°æˆåŠŸ: ${JSON.stringify(result, null, 2)}`, 'success');
            } catch (error) {
                logResult('configResult', `é…ç½®æ›´æ–°å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testValidateConfig() {
            try {
                logResult('configResult', 'æ­£åœ¨éªŒè¯é…ç½®...', 'info');
                const config = {
                    provider: 'mock',
                    model: 'test-model',
                    chunk_size: 1000
                };
                const result = await apiClient.validateConfig('embeddings', config);
                logResult('configResult', `é…ç½®éªŒè¯å®Œæˆ: ${JSON.stringify(result, null, 2)}`, 'success');
            } catch (error) {
                logResult('configResult', `é…ç½®éªŒè¯å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            logResult('statusResult', 'é¡µé¢åŠ è½½å®Œæˆï¼ŒAPIå®¢æˆ·ç«¯å·²åˆå§‹åŒ–', 'info');
            logResult('operationResult', 'å‡†å¤‡æµ‹è¯•æ¨¡å‹æ“ä½œAPI', 'info');
            logResult('configResult', 'å‡†å¤‡æµ‹è¯•é…ç½®ç®¡ç†API', 'info');
            
            // æ£€æŸ¥apiClientæ˜¯å¦å¯ç”¨
            if (typeof apiClient !== 'undefined') {
                logResult('statusResult', 'apiClientå·²æˆåŠŸåŠ è½½', 'success');
            } else {
                logResult('statusResult', 'apiClientåŠ è½½å¤±è´¥', 'error');
            }
        });
    </script>
</body>
</html>