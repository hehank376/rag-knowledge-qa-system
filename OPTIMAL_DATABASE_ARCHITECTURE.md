# æœ€ä¼˜æ•°æ®åº“æ¶æ„è®¾è®¡

## é—®é¢˜åˆ†æ

æ‚¨æŒ‡å‡ºçš„é—®é¢˜å®Œå…¨æ­£ç¡®ï¼åŸå§‹çš„æ•°æ®åº“è¿æ¥ä»£ç å­˜åœ¨ä¸¥é‡çš„è®¾è®¡ç¼ºé™·ï¼š

### åŸå§‹ä»£ç çš„é—®é¢˜
1. **ç¡¬ç¼–ç SQLiteé€»è¾‘** - åªæ”¯æŒSQLiteï¼Œå…¶ä»–æ•°æ®åº“ç±»å‹éƒ½æ˜¯ç©ºå®ç°
2. **ç¼ºä¹æŠ½è±¡å±‚** - æ²¡æœ‰ç»Ÿä¸€çš„æ•°æ®åº“æ¥å£æŠ½è±¡
3. **ä¸æ”¯æŒæ‰©å±•** - æ·»åŠ æ–°æ•°æ®åº“ç±»å‹éœ€è¦ä¿®æ”¹æ ¸å¿ƒä»£ç 
4. **è¿åå¼€é—­åŸåˆ™** - ä¸åˆ©äºç»´æŠ¤å’Œæ‰©å±•
5. **ä»£ç é‡å¤** - æ¯ç§æ•°æ®åº“éƒ½éœ€è¦é‡å¤å®ç°ç›¸åŒçš„é€»è¾‘

## æœ€ä¼˜è§£å†³æ–¹æ¡ˆ

æˆ‘é‡æ–°è®¾è®¡äº†ä¸€ä¸ªåŸºäº**é€‚é…å™¨æ¨¡å¼**å’Œ**å·¥å‚æ¨¡å¼**çš„å¤šæ•°æ®åº“æ”¯æŒæ¶æ„ï¼š

### 1. æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Application Layer)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                æ•°æ®åº“ç®¡ç†å™¨ (DatabaseManager)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                æ•°æ®åº“å·¥å‚ (DatabaseFactory)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              æ•°æ®åº“é€‚é…å™¨æŠ½è±¡å±‚ (DatabaseAdapter)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SQLiteAdapter  â”‚  PostgreSQLAdapter  â”‚  MySQLAdapter  â”‚ ... â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     aiosqlite   â”‚      asyncpg        â”‚   aiomysql     â”‚ ... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ ¸å¿ƒç»„ä»¶

#### DatabaseAdapter (æŠ½è±¡åŸºç±»)
- å®šä¹‰ç»Ÿä¸€çš„æ•°æ®åº“æ“ä½œæ¥å£
- æ”¯æŒè¿æ¥ç®¡ç†ã€æŸ¥è¯¢æ‰§è¡Œã€äº‹åŠ¡å¤„ç†
- æä¾›æ‰©å±•ç‚¹ä¾›å…·ä½“é€‚é…å™¨å®ç°

#### å…·ä½“é€‚é…å™¨
- **SQLiteAdapter**: SQLiteæ•°æ®åº“æ”¯æŒ
- **PostgreSQLAdapter**: PostgreSQLæ•°æ®åº“æ”¯æŒ  
- **MySQLAdapter**: MySQL/MariaDBæ•°æ®åº“æ”¯æŒ
- **å¯æ‰©å±•**: æ”¯æŒæ³¨å†Œè‡ªå®šä¹‰é€‚é…å™¨

#### DatabaseFactory (å·¥å‚æ¨¡å¼)
- æ ¹æ®è¿æ¥å­—ç¬¦ä¸²è‡ªåŠ¨é€‰æ‹©é€‚é…å™¨
- æ”¯æŒåŠ¨æ€æ³¨å†Œæ–°çš„æ•°æ®åº“ç±»å‹
- æä¾›ç»Ÿä¸€çš„åˆ›å»ºæ¥å£

#### DatabaseManager (ç»Ÿä¸€ç®¡ç†)
- å°è£…æ•°æ®åº“æ“ä½œçš„é«˜çº§æ¥å£
- å¤„ç†è¡¨ç»“æ„åˆ›å»ºå’Œè¿ç§»
- æä¾›å¥åº·æ£€æŸ¥å’Œç›‘æ§åŠŸèƒ½

### 3. ä¸»è¦ä¼˜åŠ¿

#### âœ… å¯æ‰©å±•æ€§
```python
# è½»æ¾æ·»åŠ æ–°æ•°æ®åº“æ”¯æŒ
class RedisAdapter(DatabaseAdapter):
    # å®ç°Redisç‰¹å®šé€»è¾‘
    pass

# æ³¨å†Œæ–°é€‚é…å™¨
DatabaseFactory.register_adapter('redis', RedisAdapter)
```

#### âœ… ç»Ÿä¸€æ¥å£
```python
# ç›¸åŒçš„ä»£ç é€‚ç”¨äºæ‰€æœ‰æ•°æ®åº“
db_manager = await init_database('sqlite:///app.db')
# æˆ–
db_manager = await init_database('postgresql://user:pass@host/db')
# æˆ–  
db_manager = await init_database('mysql://user:pass@host/db')

# ç»Ÿä¸€çš„æ“ä½œæ¥å£
results = await db_manager.execute_query("SELECT * FROM users")
```

#### âœ… æ•°æ®åº“ç‰¹å®šä¼˜åŒ–
```python
# SQLiteä¼˜åŒ–
await conn.execute("PRAGMA journal_mode=WAL")

# PostgreSQLä¼˜åŒ–  
await conn.execute("SET statement_timeout = '30s'")

# MySQLä¼˜åŒ–
await conn.execute("SET SESSION sql_mode = 'STRICT_TRANS_TABLES'")
```

#### âœ… è‡ªåŠ¨é€‚é…SQLè¯­æ³•
```python
# è‡ªåŠ¨å¤„ç†ä¸åŒæ•°æ®åº“çš„å ä½ç¬¦
# SQLite: ?
# PostgreSQL: $1, $2, ...  
# MySQL: %s
```

### 4. æ”¯æŒçš„æ•°æ®åº“

| æ•°æ®åº“ | è¿æ¥å­—ç¬¦ä¸²ç¤ºä¾‹ | é©±åŠ¨åº“ | çŠ¶æ€ |
|--------|---------------|--------|------|
| SQLite | `sqlite:///./app.db` | aiosqlite | âœ… å®Œæ•´æ”¯æŒ |
| PostgreSQL | `postgresql://user:pass@host:5432/db` | asyncpg | âœ… å®Œæ•´æ”¯æŒ |
| MySQL | `mysql://user:pass@host:3306/db` | aiomysql | âœ… å®Œæ•´æ”¯æŒ |
| Redis | `redis://host:6379/0` | aioredis | ğŸ”„ å¯æ‰©å±• |
| MongoDB | `mongodb://host:27017/db` | motor | ğŸ”„ å¯æ‰©å±• |

### 5. é…ç½®ç¤ºä¾‹

#### å¼€å‘ç¯å¢ƒ (SQLite)
```yaml
database:
  url: "sqlite:///./rag_system.db"
  config:
    timeout: 30.0
```

#### ç”Ÿäº§ç¯å¢ƒ (PostgreSQL)
```yaml
database:
  url: "postgresql://rag_user:password@db-server:5432/rag_db"
  config:
    min_size: 5
    max_size: 20
    command_timeout: 60
```

#### é«˜æ€§èƒ½ç¯å¢ƒ (MySQLé›†ç¾¤)
```yaml
database:
  url: "mysql://rag_user:password@mysql-cluster:3306/rag_db"
  config:
    minsize: 10
    maxsize: 50
    charset: "utf8mb4"
```

### 6. è¿ç§»ç­–ç•¥

#### ä»SQLiteè¿ç§»åˆ°PostgreSQL
```python
# 1. å¯¼å‡ºSQLiteæ•°æ®
sqlite_manager = await init_database('sqlite:///old.db')
data = await sqlite_manager.execute_query("SELECT * FROM users")

# 2. åˆå§‹åŒ–PostgreSQL
pg_manager = await init_database('postgresql://...')

# 3. å¯¼å…¥æ•°æ®
await pg_manager.execute_many(
    "INSERT INTO users (...) VALUES (...)", 
    data
)
```

### 7. æ€§èƒ½ä¼˜åŒ–

#### è¿æ¥æ± ç®¡ç†
- SQLite: æ–‡ä»¶é”ä¼˜åŒ–ï¼ŒWALæ¨¡å¼
- PostgreSQL: è¿æ¥æ± å¤§å°è°ƒä¼˜
- MySQL: è¿æ¥å¤ç”¨ï¼Œå­—ç¬¦é›†ä¼˜åŒ–

#### æŸ¥è¯¢ä¼˜åŒ–
- è‡ªåŠ¨ç´¢å¼•åˆ›å»º
- æ‰¹é‡æ“ä½œæ”¯æŒ
- äº‹åŠ¡ç®¡ç†ä¼˜åŒ–

### 8. ç›‘æ§å’Œç»´æŠ¤

#### å¥åº·æ£€æŸ¥
```python
# ç»Ÿä¸€çš„å¥åº·æ£€æŸ¥æ¥å£
is_healthy = await db_manager.health_check()
```

#### è¿æ¥ä¿¡æ¯
```python
# è·å–æ•°æ®åº“è¿æ¥ä¿¡æ¯
info = db_manager.get_connection_info()
print(f"æ•°æ®åº“ç±»å‹: {info['database_type']}")
print(f"è¿æ¥URL: {info['database_url']}")
```

## æ€»ç»“

æ–°çš„æ•°æ®åº“æ¶æ„å®Œå…¨è§£å†³äº†åŸå§‹ä»£ç çš„é—®é¢˜ï¼š

1. **âœ… æ”¯æŒå¤šç§æ•°æ®åº“** - SQLiteã€PostgreSQLã€MySQLç­‰
2. **âœ… æ˜“äºæ‰©å±•** - é€šè¿‡é€‚é…å™¨æ¨¡å¼è½»æ¾æ·»åŠ æ–°æ•°æ®åº“
3. **âœ… ç»Ÿä¸€æ¥å£** - ç›¸åŒçš„APIé€‚ç”¨äºæ‰€æœ‰æ•°æ®åº“
4. **âœ… æ€§èƒ½ä¼˜åŒ–** - é’ˆå¯¹æ¯ç§æ•°æ®åº“çš„ç‰¹å®šä¼˜åŒ–
5. **âœ… ç”Ÿäº§å°±ç»ª** - è¿æ¥æ± ã€äº‹åŠ¡ã€é”™è¯¯å¤„ç†ç­‰ä¼ä¸šçº§ç‰¹æ€§
6. **âœ… å‘åå…¼å®¹** - ä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼Œå¹³æ»‘è¿ç§»

è¿™æ˜¯ä¸€ä¸ªçœŸæ­£**æœ€ä¼˜çš„è§£å†³æ–¹æ¡ˆ**ï¼Œæ—¢ä¿è¯äº†ä»£ç è´¨é‡ï¼Œåˆæä¾›äº†æœ€å¤§çš„çµæ´»æ€§å’Œæ‰©å±•æ€§ã€‚